<CourseFloatingBanner chapter={2}
  classNames="absolute z-10 right-0 top-0"
  notebooks={[
    {label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/agents-course/blob/main/notebooks/unit2/smolagents/code_agents.ipynb"},
]} />

# æ„å»ºä½¿ç”¨ä»£ç çš„æ™ºèƒ½ä½“

ä»£ç æ™ºèƒ½ä½“ï¼ˆCode agentsï¼‰æ˜¯ `smolagents` ä¸­çš„é»˜è®¤æ™ºèƒ½ä½“ç±»å‹ã€‚å®ƒä»¬ç”Ÿæˆ Python å·¥å…·è°ƒç”¨æ¥æ‰§è¡Œæ“ä½œï¼Œå®ç°é«˜æ•ˆã€è¡¨è¾¾åŠ›å¼ºä¸”å‡†ç¡®çš„æ“ä½œè¡¨ç¤ºã€‚

å®ƒä»¬çš„ç®€åŒ–æ–¹æ³•å‡å°‘äº†æ‰€éœ€æ“ä½œçš„æ•°é‡ï¼Œç®€åŒ–äº†å¤æ‚æ“ä½œï¼Œå¹¶å®ç°äº†å¯¹ç°æœ‰ä»£ç å‡½æ•°çš„é‡ç”¨ã€‚`smolagents` æä¾›äº†ä¸€ä¸ªè½»é‡çº§æ¡†æ¶ï¼Œç”¨çº¦ 1,000 è¡Œä»£ç å®ç°æ„å»ºä»£ç æ™ºèƒ½ä½“ï¼ˆcode agentsï¼‰ã€‚

![ä»£ç ä¸ JSON æ“ä½œå¯¹æ¯”](https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/transformers/code_vs_json_actions.png)
å›¾ç‰‡æ¥è‡ªè®ºæ–‡ [Executable Code Actions Elicit Better LLM Agents](https://huggingface.co/papers/2402.01030)

<Tip>
å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºä¸ºä»€ä¹ˆä»£ç æ™ºèƒ½ä½“å¦‚æ­¤æœ‰æ•ˆçš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ <a href="https://huggingface.co/docs/smolagents/en/conceptual_guides/intro_agents#code-agents" target="_blank">smolagents æ–‡æ¡£ä¸­çš„è¿™ä¸ªæŒ‡å—</a>ã€‚
</Tip>

## ä¸ºä»€ä¹ˆé€‰æ‹©ä»£ç æ™ºèƒ½ä½“ï¼Ÿ

åœ¨å¤šæ­¥éª¤æ™ºèƒ½ä½“è¿‡ç¨‹ä¸­ï¼Œå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ç¼–å†™å¹¶æ‰§è¡Œæ“ä½œï¼Œé€šå¸¸æ¶‰åŠå¤–éƒ¨å·¥å…·è°ƒç”¨ã€‚ä¼ ç»Ÿæ–¹æ³•ä½¿ç”¨ JSON æ ¼å¼æ¥æŒ‡å®šå·¥å…·åç§°å’Œå‚æ•°ä½œä¸ºå­—ç¬¦ä¸²ï¼Œ**ç³»ç»Ÿå¿…é¡»è§£æè¿™äº›å†…å®¹ä»¥ç¡®å®šè¦æ‰§è¡Œå“ªä¸ªå·¥å…·**ã€‚

ç„¶è€Œï¼Œç ”ç©¶è¡¨æ˜ï¼Œ**å·¥å…·è°ƒç”¨å‹å¤§è¯­è¨€æ¨¡å‹ç›´æ¥ä½¿ç”¨ä»£ç å·¥ä½œæ›´æœ‰æ•ˆ**ã€‚è¿™æ˜¯ `smolagents` çš„æ ¸å¿ƒåŸåˆ™ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ¥è‡ªè®ºæ–‡ [Executable Code Actions Elicit Better LLM Agents](https://huggingface.co/papers/2402.01030)ã€‚

ç”¨ä»£ç è€Œé JSON ç¼–å†™æ“ä½œæä¾›äº†å‡ ä¸ªå…³é”®ä¼˜åŠ¿ï¼š

* **å¯ç»„åˆæ€§ï¼ˆComposabilityï¼‰**ï¼šè½»æ¾ç»„åˆå’Œé‡ç”¨æ“ä½œ
* **å¯¹è±¡ç®¡ç†ï¼ˆObject Managementï¼‰**ï¼šç›´æ¥å¤„ç†å¤æ‚ç»“æ„ï¼Œå¦‚å›¾åƒ
* **é€šç”¨æ€§ï¼ˆGeneralityï¼‰**ï¼šè¡¨è¾¾ä»»ä½•è®¡ç®—ä¸Šå¯èƒ½çš„ä»»åŠ¡
* **é€‚åˆå¤§è¯­è¨€æ¨¡å‹**ï¼šé«˜è´¨é‡ä»£ç å·²å­˜åœ¨äºå¤§è¯­è¨€æ¨¡å‹çš„è®­ç»ƒæ•°æ®ä¸­

## ä»£ç æ™ºèƒ½ä½“å¦‚ä½•å·¥ä½œï¼Ÿ

![æ¥è‡ª https://huggingface.co/docs/smolagents/conceptual_guides/react](https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/smolagents/codeagent_docs.png)

ä¸Šå›¾è¯´æ˜äº† `CodeAgent.run()` å¦‚ä½•æ“ä½œï¼Œéµå¾ªæˆ‘ä»¬åœ¨ç¬¬ 1 å•å…ƒä¸­æåˆ°çš„ ReAct æ¡†æ¶ã€‚`smolagents` ä¸­æ™ºèƒ½ä½“çš„ä¸»è¦æŠ½è±¡æ˜¯ `MultiStepAgent`ï¼Œå®ƒä½œä¸ºæ ¸å¿ƒæ„å»ºå—ã€‚å¦‚æˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­çœ‹åˆ°çš„ï¼Œ`CodeAgent` æ˜¯ä¸€ç§ç‰¹æ®Šçš„ `MultiStepAgent`ã€‚

`CodeAgent` é€šè¿‡ä¸€ç³»åˆ—æ­¥éª¤æ‰§è¡Œæ“ä½œï¼Œå°†ç°æœ‰å˜é‡å’ŒçŸ¥è¯†æ•´åˆåˆ°æ™ºèƒ½ä½“çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™äº›å†…å®¹ä¿å­˜åœ¨æ‰§è¡Œæ—¥å¿—ä¸­ï¼š

1. ç³»ç»Ÿæç¤ºå­˜å‚¨åœ¨ `SystemPromptStep` ä¸­ï¼Œç”¨æˆ·æŸ¥è¯¢è®°å½•åœ¨ `TaskStep` ä¸­ã€‚

2. ç„¶åï¼Œæ‰§è¡Œä»¥ä¸‹å¾ªç¯ï¼š

    2.1 æ–¹æ³• `agent.write_memory_to_messages()` å°†æ™ºèƒ½ä½“çš„æ—¥å¿—å†™å…¥å¤§è¯­è¨€æ¨¡å‹å¯è¯»çš„[èŠå¤©æ¶ˆæ¯](https://huggingface.co/docs/transformers/en/chat_templating)åˆ—è¡¨ä¸­ã€‚
    
    2.2 è¿™äº›æ¶ˆæ¯å‘é€ç»™ `Model`ï¼Œç”Ÿæˆè¡¥å…¨ï¼ˆcompletionï¼‰ã€‚
    
    2.3 è§£æè¡¥å…¨å†…å®¹ä»¥æå–æ“ä½œï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™åº”è¯¥æ˜¯ä»£ç ç‰‡æ®µï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ `CodeAgent`ã€‚
    
    2.4 æ‰§è¡Œè¯¥æ“ä½œã€‚
    
    2.5 å°†ç»“æœè®°å½•åˆ°å†…å­˜ä¸­çš„ `ActionStep` ä¸­ã€‚

åœ¨æ¯ä¸ªæ­¥éª¤ç»“æŸæ—¶ï¼Œå¦‚æœæ™ºèƒ½ä½“åŒ…å«ä»»ä½•å‡½æ•°è°ƒç”¨ï¼ˆåœ¨ `agent.step_callback` ä¸­ï¼‰ï¼Œå®ƒä»¬å°†è¢«æ‰§è¡Œã€‚

## è®©æˆ‘ä»¬çœ‹ä¸€äº›ä¾‹å­

<Tip>
ä½ å¯ä»¥åœ¨ <a href="https://huggingface.co/agents-course/notebooks/blob/main/unit2/smolagents/code_agents.ipynb" target="_blank">è¿™ä¸ªç¬”è®°æœ¬</a> ä¸­è·Ÿéšä»£ç ï¼Œå¯ä»¥ä½¿ç”¨ Google Colab è¿è¡Œã€‚
</Tip>

é˜¿å°”å¼—é›·å¾·ï¼ˆAlfredï¼‰æ­£åœ¨éŸ¦æ©å®¶æ—å¤§å®…è®¡åˆ’ä¸€åœºæ´¾å¯¹ï¼Œéœ€è¦ä½ çš„å¸®åŠ©ç¡®ä¿ä¸€åˆ‡é¡ºåˆ©è¿›è¡Œã€‚ä¸ºäº†å¸®åŠ©ä»–ï¼Œæˆ‘ä»¬å°†åº”ç”¨æˆ‘ä»¬æ‰€å­¦åˆ°çš„å…³äºå¤šæ­¥éª¤ `CodeAgent` å¦‚ä½•è¿ä½œçš„çŸ¥è¯†ã€‚

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit2/smolagents/alfred-party.jpg" alt="Alfred æ´¾å¯¹"/>

å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£… `smolagents`ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š

```bash
pip install smolagents -U
```

è®©æˆ‘ä»¬ä¹Ÿç™»å½•åˆ° Hugging Face Hubï¼Œä»¥ä¾¿è®¿é—®æ— æœåŠ¡å™¨æ¨ç† APIï¼ˆServerless Inference APIï¼‰ã€‚

```python
from huggingface_hub import login

login()
```

### ä½¿ç”¨ `smolagents` ä¸ºæ´¾å¯¹é€‰æ‹©æ’­æ”¾åˆ—è¡¨

éŸ³ä¹æ˜¯æˆåŠŸæ´¾å¯¹çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼é˜¿å°”å¼—é›·å¾·éœ€è¦ä¸€äº›å¸®åŠ©æ¥é€‰æ‹©æ’­æ”¾åˆ—è¡¨ã€‚å¹¸è¿çš„æ˜¯ï¼Œ`smolagents` èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ï¼æˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªèƒ½å¤Ÿä½¿ç”¨ DuckDuckGo æœç´¢ç½‘ç»œçš„æ™ºèƒ½ä½“ã€‚è¦è®©æ™ºèƒ½ä½“è®¿é—®æ­¤å·¥å…·ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºæ™ºèƒ½ä½“æ—¶å°†å…¶åŒ…å«åœ¨å·¥å…·åˆ—è¡¨ä¸­ã€‚

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit2/smolagents/alfred-playlist.jpg" alt="Alfred æ’­æ”¾åˆ—è¡¨"/>

å¯¹äºæ¨¡å‹ï¼Œæˆ‘ä»¬å°†ä¾èµ– `HfApiModel`ï¼Œå®ƒæä¾›å¯¹ Hugging Face çš„[æ— æœåŠ¡å™¨æ¨ç† API](https://huggingface.co/docs/api-inference/index)çš„è®¿é—®ã€‚é»˜è®¤æ¨¡å‹æ˜¯ `"Qwen/Qwen2.5-Coder-32B-Instruct"`ï¼Œå®ƒæ€§èƒ½è‰¯å¥½å¹¶å¯ç”¨äºå¿«é€Ÿæ¨ç†ï¼Œä½†ä½ å¯ä»¥ä» Hub ä¸­é€‰æ‹©ä»»ä½•å…¼å®¹çš„æ¨¡å‹ã€‚

è¿è¡Œæ™ºèƒ½ä½“ç›¸å½“ç®€å•ï¼š

```python
from smolagents import CodeAgent, DuckDuckGoSearchTool, HfApiModel

agent = CodeAgent(tools=[DuckDuckGoSearchTool()], model=HfApiModel())

agent.run("Search for the best music recommendations for a party at the Wayne's mansion.")
```

å½“ä½ è¿è¡Œè¿™ä¸ªä¾‹å­æ—¶ï¼Œè¾“å‡ºå°†**æ˜¾ç¤ºæ­£åœ¨æ‰§è¡Œçš„å·¥ä½œæµæ­¥éª¤çš„è·Ÿè¸ª**ã€‚å®ƒè¿˜ä¼šæ‰“å°ç›¸åº”çš„ Python ä»£ç ï¼Œå¹¶é™„å¸¦æ¶ˆæ¯ï¼š

```python
 â”€ Executing parsed code: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 
  results = web_search(query="best music for a Batman party")                                                      
  print(results)                                                                                                   
 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 
```

å‡ ä¸ªæ­¥éª¤åï¼Œä½ å°†çœ‹åˆ°é˜¿å°”å¼—é›·å¾·å¯ä»¥ç”¨äºæ´¾å¯¹çš„ç”Ÿæˆæ’­æ”¾åˆ—è¡¨ï¼ğŸµ

### ä½¿ç”¨è‡ªå®šä¹‰å·¥å…·å‡†å¤‡èœå•

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit2/smolagents/alfred-menu.jpg" alt="Alfred èœå•"/>

ç°åœ¨æˆ‘ä»¬å·²ç»é€‰æ‹©äº†æ’­æ”¾åˆ—è¡¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå®¢äººç»„ç»‡èœå•ã€‚åŒæ ·ï¼Œé˜¿å°”å¼—é›·å¾·å¯ä»¥åˆ©ç”¨ `smolagents` æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ `@tool` è£…é¥°å™¨å®šä¹‰ä¸€ä¸ªä½œä¸ºå·¥å…·çš„è‡ªå®šä¹‰å‡½æ•°ã€‚æˆ‘ä»¬ç¨åå°†æ›´è¯¦ç»†åœ°ä»‹ç»å·¥å…·åˆ›å»ºï¼Œæ‰€ä»¥ç°åœ¨æˆ‘ä»¬å¯ä»¥ç®€å•åœ°è¿è¡Œä»£ç ã€‚

å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ `@tool` è£…é¥°å™¨åˆ›å»ºä¸€ä¸ªå·¥å…·ï¼Œå¹¶å°†å…¶åŒ…å«åœ¨ `tools` åˆ—è¡¨ä¸­ã€‚

```python
from smolagents import CodeAgent, tool

# æ ¹æ®åœºåˆå»ºè®®èœå•çš„å·¥å…·
@tool
def suggest_menu(occasion: str) -> str:
    """
    Suggests a menu based on the occasion.
    Args:
        occasion: The type of occasion for the party.
    """
    if occasion == "casual":
        return "Pizza, snacks, and drinks."
    elif occasion == "formal":
        return "3-course dinner with wine and dessert."
    elif occasion == "superhero":
        return "Buffet with high-energy and healthy food."
    else:
        return "Custom menu for the butler."

# ç®¡å®¶é˜¿å°”å¼—é›·å¾·ï¼Œä¸ºæ´¾å¯¹å‡†å¤‡èœå•
agent = CodeAgent(tools=[suggest_menu], model=HfApiModel())

# ä¸ºæ´¾å¯¹å‡†å¤‡æ­£å¼èœå•
agent.run("Prepare a formal menu for the party.")
```

æ™ºèƒ½ä½“å°†è¿è¡Œå‡ ä¸ªæ­¥éª¤ï¼Œç›´åˆ°æ‰¾åˆ°ç­”æ¡ˆã€‚

èœå•å‡†å¤‡å¥½äº†ï¼ğŸ¥—

### åœ¨æ™ºèƒ½ä½“å†…éƒ¨ä½¿ç”¨ Python å¯¼å…¥

æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†æ’­æ”¾åˆ—è¡¨å’Œèœå•ï¼Œä½†æˆ‘ä»¬éœ€è¦æ£€æŸ¥å¦ä¸€ä¸ªå…³é”®ç»†èŠ‚ï¼šå‡†å¤‡æ—¶é—´ï¼

é˜¿å°”å¼—é›·å¾·éœ€è¦è®¡ç®—å¦‚æœä»–ç°åœ¨å¼€å§‹å‡†å¤‡ï¼Œä»€ä¹ˆæ—¶å€™ä¸€åˆ‡éƒ½ä¼šå‡†å¤‡å°±ç»ªï¼Œä»¥é˜²ä»–ä»¬éœ€è¦å…¶ä»–è¶…çº§è‹±é›„çš„å¸®åŠ©ã€‚

`smolagents` ä¸“é—¨ç”¨äºç¼–å†™å’Œæ‰§è¡Œ Python ä»£ç ç‰‡æ®µçš„æ™ºèƒ½ä½“ï¼Œä¸ºå®‰å…¨æä¾›æ²™ç›’æ‰§è¡Œç¯å¢ƒã€‚  
**ä»£ç æ‰§è¡Œæœ‰ä¸¥æ ¼çš„å®‰å…¨æªæ–½** - é»˜è®¤æƒ…å†µä¸‹ï¼Œé¢„å®šä¹‰å®‰å…¨åˆ—è¡¨ä¹‹å¤–çš„å¯¼å…¥è¢«é˜»æ­¢ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥é€šè¿‡å°†å®ƒä»¬ä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’åˆ° `additional_authorized_imports` ä¸­æ¥æˆæƒé¢å¤–çš„å¯¼å…¥ã€‚
æœ‰å…³å®‰å…¨ä»£ç æ‰§è¡Œçš„æ›´å¤šè¯¦æƒ…ï¼Œè¯·å‚é˜…å®˜æ–¹[æŒ‡å—](https://huggingface.co/docs/smolagents/tutorials/secure_code_execution)ã€‚

åˆ›å»ºæ™ºèƒ½ä½“æ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ `additional_authorized_imports` æ¥å…è®¸å¯¼å…¥ `datetime` æ¨¡å—ã€‚

```python
from smolagents import CodeAgent, HfApiModel
import numpy as np
import time
import datetime

agent = CodeAgent(tools=[], model=HfApiModel(), additional_authorized_imports=['datetime'])

agent.run(
    """
    Alfred needs to prepare for the party. Here are the tasks:
    1. Prepare the drinks - 30 minutes
    2. Decorate the mansion - 60 minutes
    3. Set up the menu - 45 minutes
    3. Prepare the music and playlist - 45 minutes

    If we start right now, at what time will the party be ready?
    """
)
```

è¿™äº›ä¾‹å­åªæ˜¯ä»£ç æ™ºèƒ½ä½“èƒ½åšçš„äº‹æƒ…çš„å¼€å§‹ï¼Œæˆ‘ä»¬å·²ç»å¼€å§‹çœ‹åˆ°å®ƒä»¬å¯¹å‡†å¤‡æ´¾å¯¹çš„å®ç”¨æ€§ã€‚
ä½ å¯ä»¥åœ¨ [smolagents æ–‡æ¡£](https://huggingface.co/docs/smolagents) ä¸­äº†è§£æ›´å¤šå…³äºå¦‚ä½•æ„å»ºä»£ç æ™ºèƒ½ä½“çš„ä¿¡æ¯ã€‚

æ€»ä¹‹ï¼Œ`smolagents` ä¸“æ³¨äºç¼–å†™å’Œæ‰§è¡Œ Python ä»£ç ç‰‡æ®µçš„æ™ºèƒ½ä½“ï¼Œæä¾›å®‰å…¨çš„æ²™ç›’æ‰§è¡Œç¯å¢ƒã€‚å®ƒæ”¯æŒæœ¬åœ°å’ŒåŸºäº API çš„è¯­è¨€æ¨¡å‹ï¼Œä½¿å…¶é€‚åº”å„ç§å¼€å‘ç¯å¢ƒã€‚

### å°†æˆ‘ä»¬çš„è‡ªå®šä¹‰æ´¾å¯¹å‡†å¤‡æ™ºèƒ½ä½“åˆ†äº«åˆ° Hub

**å°†æˆ‘ä»¬è‡ªå·±çš„é˜¿å°”å¼—é›·å¾·æ™ºèƒ½ä½“ä¸ç¤¾åŒºåˆ†äº«**éš¾é“ä¸ä¼šå¾ˆæ£’å—ï¼Ÿé€šè¿‡è¿™æ ·åšï¼Œä»»ä½•äººéƒ½å¯ä»¥è½»æ¾åœ°ä» Hub ä¸‹è½½å¹¶ç›´æ¥ä½¿ç”¨è¿™ä¸ªæ™ºèƒ½ä½“ï¼Œå°†å“¥è°­å¸‚çš„ç»ˆææ´¾å¯¹ç­–åˆ’è€…å¸¦åˆ°ä»–ä»¬çš„æŒ‡å°–ï¼è®©æˆ‘ä»¬å®ç°è¿™ä¸ªæƒ³æ³•ï¼ğŸ‰

`smolagents` åº“ä½¿è¿™æˆä¸ºå¯èƒ½ï¼Œå…è®¸ä½ ä¸ç¤¾åŒºåˆ†äº«å®Œæ•´çš„æ™ºèƒ½ä½“ï¼Œå¹¶ä¸‹è½½å…¶ä»–äººçš„æ™ºèƒ½ä½“ç«‹å³ä½¿ç”¨ã€‚è¿™å¾ˆç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```python
# æ›´æ”¹ä¸ºä½ çš„ç”¨æˆ·åå’Œä»“åº“å
agent.push_to_hub('sergiopaniego/AlfredAgent')
```

è¦å†æ¬¡ä¸‹è½½æ™ºèƒ½ä½“ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š

```python
# æ›´æ”¹ä¸ºä½ çš„ç”¨æˆ·åå’Œä»“åº“å
alfred_agent = agent.from_hub('sergiopaniego/AlfredAgent')

alfred_agent.run("Give me the best playlist for a party at Wayne's mansion. The party idea is a 'villain masquerade' theme")  
```

ä»¤äººå…´å¥‹çš„æ˜¯ï¼Œå…±äº«çš„æ™ºèƒ½ä½“ç›´æ¥ä½œä¸º Hugging Face Spaces æä¾›ï¼Œå…è®¸ä½ å®æ—¶ä¸å®ƒä»¬äº¤äº’ã€‚ä½ å¯ä»¥åœ¨[è¿™é‡Œ](https://huggingface.co/spaces/davidberenstein1957/smolagents-and-tools)æ¢ç´¢å…¶ä»–æ™ºèƒ½ä½“ã€‚

ä¾‹å¦‚ï¼Œ_AlfredAgent_ åœ¨[è¿™é‡Œ](https://huggingface.co/spaces/sergiopaniego/AlfredAgent)å¯ç”¨ã€‚ä½ å¯ä»¥ç›´æ¥åœ¨ä¸‹é¢å°è¯•ï¼š

<iframe
	src="https://sergiopaniego-alfredagent.hf.space/"
	frameborder="0"
	width="850"
	height="450"
></iframe>

ä½ å¯èƒ½æƒ³çŸ¥é“â€”â€”é˜¿å°”å¼—é›·å¾·å¦‚ä½•ä½¿ç”¨ `smolagents` æ„å»ºè¿™æ ·ä¸€ä¸ªæ™ºèƒ½ä½“ï¼Ÿé€šè¿‡æ•´åˆå‡ ä¸ªå·¥å…·ï¼Œä»–å¯ä»¥ç”Ÿæˆä¸€ä¸ªå¦‚ä¸‹çš„æ™ºèƒ½ä½“ã€‚ç°åœ¨ä¸ç”¨æ‹…å¿ƒè¿™äº›å·¥å…·ï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ¨æœ¬å•å…ƒåé¢æœ‰ä¸“é—¨çš„éƒ¨åˆ†è¯¦ç»†æ¢è®¨ï¼š

```python
from smolagents import CodeAgent, DuckDuckGoSearchTool, FinalAnswerTool, HfApiModel, Tool, tool, VisitWebpageTool

@tool
def suggest_menu(occasion: str) -> str:
    """
    Suggests a menu based on the occasion.
    Args:
        occasion: The type of occasion for the party.
    """
    if occasion == "casual":
        return "Pizza, snacks, and drinks."
    elif occasion == "formal":
        return "3-course dinner with wine and dessert."
    elif occasion == "superhero":
        return "Buffet with high-energy and healthy food."
    else:
        return "Custom menu for the butler."

@tool
def catering_service_tool(query: str) -> str:
    """
    This tool returns the highest-rated catering service in Gotham City.
    
    Args:
        query: A search term for finding catering services.
    """
    # é¤é¥®æœåŠ¡åŠå…¶è¯„åˆ†çš„ç¤ºä¾‹åˆ—è¡¨    
    services = {
        "Gotham Catering Co.": 4.9,
        "Wayne Manor Catering": 4.8,
        "Gotham City Events": 4.7,
    }
    
    # æ‰¾åˆ°è¯„åˆ†æœ€é«˜çš„é¤é¥®æœåŠ¡ï¼ˆæ¨¡æ‹Ÿæœç´¢æŸ¥è¯¢è¿‡æ»¤ï¼‰
    best_service = max(services, key=services.get)
    
    return best_service

class SuperheroPartyThemeTool(Tool):
    name = "superhero_party_theme_generator"
    description = """
    This tool suggests creative superhero-themed party ideas based on a category.
    It returns a unique party theme idea."""
    
    inputs = {
        "category": {
            "type": "string",
            "description": "The type of superhero party (e.g., 'classic heroes', 'villain masquerade', 'futuristic Gotham').",
        }
    }
    
    output_type = "string"

    def forward(self, category: str):
        themes = {
            "classic heroes": "Justice League Gala: Guests come dressed as their favorite DC heroes with themed cocktails like 'The Kryptonite Punch'.",
            "villain masquerade": "Gotham Rogues' Ball: A mysterious masquerade where guests dress as classic Batman villains.",
            "futuristic Gotham": "Neo-Gotham Night: A cyberpunk-style party inspired by Batman Beyond, with neon decorations and futuristic gadgets."
        }
        
        return themes.get(category.lower(), "Themed party idea not found. Try 'classic heroes', 'villain masquerade', or 'futuristic Gotham'.")


# ç®¡å®¶é˜¿å°”å¼—é›·å¾·ï¼Œä¸ºæ´¾å¯¹å‡†å¤‡èœå•
agent = CodeAgent(
    tools=[
        DuckDuckGoSearchTool(), 
        VisitWebpageTool(),
        suggest_menu,
        catering_service_tool,
        SuperheroPartyThemeTool()
    ], 
    model=HfApiModel(),
    max_steps=10,
    verbosity_level=2
)

agent.run("Give me best playlist for a party at the Wayne's mansion. The party idea is a 'villain masquerade' theme")
```

å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰å¤šç§å·¥å…·çš„ `CodeAgent`ï¼Œè¿™äº›å·¥å…·å¢å¼ºäº†æ™ºèƒ½ä½“çš„åŠŸèƒ½ï¼Œå°†å…¶å˜æˆäº†å‡†å¤‡å¥½ä¸ç¤¾åŒºåˆ†äº«çš„ç»ˆææ´¾å¯¹ç­–åˆ’è€…ï¼ğŸ‰

ç°åœ¨ï¼Œè½®åˆ°ä½ äº†ï¼šä½¿ç”¨æˆ‘ä»¬åˆšåˆšå­¦åˆ°çš„çŸ¥è¯†ï¼Œæ„å»ºä½ è‡ªå·±çš„æ™ºèƒ½ä½“å¹¶ä¸ç¤¾åŒºåˆ†äº«ï¼ğŸ•µï¸â€â™‚ï¸ğŸ’¡

<Tip>
å¦‚æœä½ æƒ³åˆ†äº«ä½ çš„æ™ºèƒ½ä½“é¡¹ç›®ï¼Œè¯·åˆ›å»ºä¸€ä¸ª space å¹¶åœ¨ Hugging Face Hub ä¸Šæ ‡è®° [agents-course](https://huggingface.co/agents-course)ã€‚æˆ‘ä»¬å¾ˆæƒ³çœ‹çœ‹ä½ åˆ›é€ äº†ä»€ä¹ˆï¼
</Tip>

### ä½¿ç”¨ OpenTelemetry å’Œ Langfuse æ£€æŸ¥æˆ‘ä»¬çš„æ´¾å¯¹å‡†å¤‡æ™ºèƒ½ä½“ ğŸ“¡

éšç€é˜¿å°”å¼—é›·å¾·å¯¹æ´¾å¯¹å‡†å¤‡æ™ºèƒ½ä½“çš„å¾®è°ƒï¼Œä»–å¯¹è°ƒè¯•å…¶è¿è¡Œè¶Šæ¥è¶Šç–²æƒ«ã€‚æ™ºèƒ½ä½“æœ¬è´¨ä¸Šæ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œéš¾ä»¥æ£€æŸ¥ã€‚ä½†ç”±äºä»–çš„ç›®æ ‡æ˜¯æ„å»ºç»ˆææ´¾å¯¹å‡†å¤‡æ™ºèƒ½ä½“å¹¶å°†å…¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä»–éœ€è¦å¼ºå¤§çš„å¯è¿½è¸ªæ€§ï¼Œç”¨äºæœªæ¥çš„ç›‘æ§å’Œåˆ†æã€‚

å†ä¸€æ¬¡ï¼Œ`smolagents` æ¥æ•‘æ´ï¼å®ƒé‡‡ç”¨ [OpenTelemetry](https://opentelemetry.io/) æ ‡å‡†æ¥æ£€æµ‹æ™ºèƒ½ä½“è¿è¡Œï¼Œå…è®¸æ— ç¼æ£€æŸ¥å’Œæ—¥å¿—è®°å½•ã€‚åœ¨ [Langfuse](https://langfuse.com/) å’Œ `SmolagentsInstrumentor` çš„å¸®åŠ©ä¸‹ï¼Œé˜¿å°”å¼—é›·å¾·å¯ä»¥è½»æ¾è·Ÿè¸ªå’Œåˆ†æä»–çš„æ™ºèƒ½ä½“è¡Œä¸ºã€‚

è®¾ç½®éå¸¸ç®€å•ï¼

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…å¿…è¦çš„ä¾èµ–é¡¹ï¼š

```bash
pip install opentelemetry-sdk opentelemetry-exporter-otlp openinference-instrumentation-smolagents
```

æ¥ä¸‹æ¥ï¼Œé˜¿å°”å¼—é›·å¾·å·²ç»åœ¨ Langfuse ä¸Šåˆ›å»ºäº†ä¸€ä¸ªè´¦æˆ·ï¼Œå¹¶å‡†å¤‡å¥½äº†ä»–çš„ API å¯†é’¥ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰è¿™æ ·åšï¼Œä½ å¯ä»¥åœ¨[è¿™é‡Œ](https://cloud.langfuse.com/)æ³¨å†Œ Langfuse Cloud æˆ–æ¢ç´¢[æ›¿ä»£æ–¹æ¡ˆ](https://huggingface.co/docs/smolagents/tutorials/inspect_runs)ã€‚

ä¸€æ—¦ä½ æœ‰äº† API å¯†é’¥ï¼Œå®ƒä»¬éœ€è¦æ­£ç¡®é…ç½®å¦‚ä¸‹ï¼š

```python
import os
import base64

LANGFUSE_PUBLIC_KEY="pk-lf-..."
LANGFUSE_SECRET_KEY="sk-lf-..."
LANGFUSE_AUTH=base64.b64encode(f"{LANGFUSE_PUBLIC_KEY}:{LANGFUSE_SECRET_KEY}".encode()).decode()

os.environ["OTEL_EXPORTER_OTLP_ENDPOINT"] = "https://cloud.langfuse.com/api/public/otel" # EU æ•°æ®åŒºåŸŸ
# os.environ["OTEL_EXPORTER_OTLP_ENDPOINT"] = "https://us.cloud.langfuse.com/api/public/otel" # US æ•°æ®åŒºåŸŸ
os.environ["OTEL_EXPORTER_OTLP_HEADERS"] = f"Authorization=Basic {LANGFUSE_AUTH}"
```

æœ€åï¼Œé˜¿å°”å¼—é›·å¾·å‡†å¤‡åˆå§‹åŒ– `SmolagentsInstrumentor` å¹¶å¼€å§‹è·Ÿè¸ªä»–çš„æ™ºèƒ½ä½“æ€§èƒ½ã€‚

```python
from opentelemetry.sdk.trace import TracerProvider

from openinference.instrumentation.smolagents import SmolagentsInstrumentor
from opentelemetry.exporter.otlp.proto.http.trace_exporter import OTLPSpanExporter
from opentelemetry.sdk.trace.export import SimpleSpanProcessor

trace_provider = TracerProvider()
trace_provider.add_span_processor(SimpleSpanProcessor(OTLPSpanExporter()))

SmolagentsInstrumentor().instrument(tracer_provider=trace_provider)
```

é˜¿å°”å¼—é›·å¾·ç°åœ¨å·²è¿æ¥ ğŸ”Œï¼æ¥è‡ª `smolagents` çš„è¿è¡Œæ­£åœ¨ Langfuse ä¸­è®°å½•ï¼Œè®©ä»–å®Œå…¨å¯è§æ™ºèƒ½ä½“çš„è¡Œä¸ºã€‚æœ‰äº†è¿™ä¸ªè®¾ç½®ï¼Œä»–å‡†å¤‡é‡æ–°è®¿é—®ä¹‹å‰çš„è¿è¡Œå¹¶è¿›ä¸€æ­¥æ”¹è¿›ä»–çš„æ´¾å¯¹å‡†å¤‡æ™ºèƒ½ä½“ã€‚

```python
from smolagents import CodeAgent, HfApiModel

agent = CodeAgent(tools=[], model=HfApiModel())
alfred_agent = agent.from_hub('sergiopaniego/AlfredAgent', trust_remote_code=True)
alfred_agent.run("Give me the best playlist for a party at Wayne's mansion. The party idea is a 'villain masquerade' theme")  
```

é˜¿å°”å¼—é›·å¾·ç°åœ¨å¯ä»¥åœ¨[è¿™é‡Œ](https://cloud.langfuse.com/project/cm7bq0abj025rad078ak3luwi/traces/995fc019255528e4f48cf6770b0ce27b?timestamp=2025-02-19T10%3A28%3A36.929Z)è®¿é—®è¿™äº›æ—¥å¿—æ¥å®¡æŸ¥å’Œåˆ†æå®ƒä»¬ã€‚

åŒæ—¶ï¼Œ[å»ºè®®çš„æ’­æ”¾åˆ—è¡¨](https://open.spotify.com/playlist/0gZMMHjuxMrrybQ7wTMTpw)ä¸ºæ´¾å¯¹å‡†å¤‡è®¾ç½®äº†å®Œç¾çš„æ°›å›´ã€‚å¾ˆé…·ï¼Œå¯¹å§ï¼ŸğŸ¶

---

ç°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºäº†æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªä»£ç æ™ºèƒ½ä½“ï¼Œè®©æˆ‘ä»¬**å­¦ä¹ å¦‚ä½•åˆ›å»ºå·¥å…·è°ƒç”¨æ™ºèƒ½ä½“ï¼ˆTool Calling Agentsï¼‰**ï¼Œè¿™æ˜¯ `smolagents` ä¸­å¯ç”¨çš„ç¬¬äºŒç§æ™ºèƒ½ä½“ç±»å‹ã€‚

## èµ„æº

- [smolagents åšå®¢](https://huggingface.co/blog/smolagents) - smolagents å’Œä»£ç äº¤äº’ä»‹ç»
- [smolagentsï¼šæ„å»ºå¥½çš„æ™ºèƒ½ä½“](https://huggingface.co/docs/smolagents/tutorials/building_good_agents) - å¯é æ™ºèƒ½ä½“çš„æœ€ä½³å®è·µ
- [æ„å»ºæœ‰æ•ˆçš„æ™ºèƒ½ä½“ - Anthropic](https://www.anthropic.com/research/building-effective-agents) - æ™ºèƒ½ä½“è®¾è®¡åŸåˆ™
- [ä½¿ç”¨ OpenTelemetry å…±äº«è¿è¡Œ](https://huggingface.co/docs/smolagents/tutorials/inspect_runs) - å…³äºå¦‚ä½•ä¸ºè·Ÿè¸ªä½ çš„æ™ºèƒ½ä½“è®¾ç½® OpenTelemetry çš„è¯¦ç»†ä¿¡æ¯