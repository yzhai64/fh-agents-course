<CourseFloatingBanner chapter={2}
  classNames="absolute z-10 right-0 top-0"
  notebooks={[
    {label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/agents-course/blob/main/notebooks/unit2/smolagents/vision_agents.ipynb"},
]} />

# ä½¿ç”¨ smolagents æ„å»ºè§†è§‰æ™ºèƒ½ä½“

<Tip warning={true}>
æœ¬èŠ‚ç¤ºä¾‹éœ€è¦æ¥å…¥å¼ºå¤§çš„è§†è§‰è¯­è¨€æ¨¡å‹ï¼ˆVLMï¼‰ã€‚æˆ‘ä»¬ä½¿ç”¨ GPT-4o API è¿›è¡Œäº†æµ‹è¯•ã€‚  
è‹¥éœ€äº†è§£ smolagents å’Œ Hugging Face æ”¯æŒçš„å…¶ä»–æ›¿ä»£æ–¹æ¡ˆï¼Œè¯·å‚è€ƒ<a href="./why_use_smolagents">ä¸ºä»€ä¹ˆé€‰æ‹©smolagents</a>ç« èŠ‚ã€‚
</Tip>

èµ‹äºˆæ™ºèƒ½ä½“è§†è§‰èƒ½åŠ›å¯¹äºè¶…è¶Šæ–‡æœ¬å¤„ç†çš„ä»»åŠ¡è‡³å…³é‡è¦ã€‚ç½‘é¡µæµè§ˆã€æ–‡æ¡£ç†è§£ç­‰ç°å®åœºæ™¯éƒ½éœ€è¦è§£æä¸°å¯Œçš„è§†è§‰å†…å®¹ã€‚smolagents å†…ç½®æ”¯æŒè§†è§‰è¯­è¨€æ¨¡å‹ï¼ˆVLMsï¼‰ï¼Œä½¿æ™ºèƒ½ä½“èƒ½å¤Ÿæœ‰æ•ˆå¤„ç†å›¾åƒä¿¡æ¯ã€‚

å‡è®¾éŸ¦æ©åº„å›­çš„ç®¡å®¶ Alfred éœ€è¦æ ¸éªŒæ´¾å¯¹å˜‰å®¾èº«ä»½ã€‚è€ƒè™‘åˆ°ä»–å¯èƒ½æ— æ³•è¯†åˆ«æ‰€æœ‰æ¥å®¾ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºåŸºäº VLM çš„æ™ºèƒ½ä½“ï¼Œé€šè¿‡è§†è§‰ä¿¡æ¯æ£€ç´¢æ¥è¾…åŠ©èº«ä»½éªŒè¯å†³ç­–ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°ï¼š


## åˆå§‹æ‰§è¡Œé˜¶æ®µæä¾›å›¾åƒ

<Tip>
é…å¥—ä»£ç å¯åœ¨<a href="https://huggingface.co/agents-course/notebooks/blob/main/unit2/smolagents/vision_agents.ipynb" target="_blank">Google Colab ç¬”è®°æœ¬</a>ä¸­æŸ¥çœ‹ã€‚
</Tip>

è¯¥æ–¹æ³•åœ¨æ™ºèƒ½ä½“å¯åŠ¨æ—¶é€šè¿‡ task_images å‚æ•°ä¼ å…¥å›¾åƒï¼Œæ™ºèƒ½ä½“åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æŒç»­å¤„ç†è¿™äº›å›¾åƒã€‚

å‡è®¾ Alfred éœ€è¦æ ¸éªŒè¶…çº§è‹±é›„èº«ä»½ï¼Œä»–å·²æœ‰å†å²æ´¾å¯¹å˜‰å®¾å›¾åƒæ•°æ®åº“ã€‚

å½“æ–°è®¿å®¢åˆ°æ¥æ—¶ï¼Œæ™ºèƒ½ä½“å¯é€šè¿‡å›¾åƒæ¯”å¯¹è¿›è¡Œå‡†å…¥å†³ç­–ã€‚

å½“å‰åœºæ™¯ä¸­ï¼ŒAlfred æ€€ç–‘è®¿å®¢å¯èƒ½æ˜¯å°ä¸‘å‡æ‰®çš„ç¥å¥‡å¥³ä¾ ã€‚æˆ‘ä»¬éœ€è¦æ„å»ºèº«ä»½éªŒè¯ç³»ç»Ÿï¼š

```python
from PIL import Image
import requests
from io import BytesIO

image_urls = [
    "https://upload.wikimedia.org/wikipedia/commons/e/e8/The_Joker_at_Wax_Museum_Plus.jpg", # å°ä¸‘å›¾åƒ
    "https://upload.wikimedia.org/wikipedia/en/9/98/Joker_%28DC_Comics_character%29.jpg" # å°ä¸‘å›¾åƒ
]

images = []
for url in image_urls:
    response = requests.get(url)
    image = Image.open(BytesIO(response.content)).convert("RGB")
    images.append(image)
```

å®Œæˆå›¾åƒåŠ è½½åï¼Œæ™ºèƒ½ä½“å°†åˆ¤æ–­è®¿å®¢èº«ä»½ï¼šç©¶ç«Ÿæ˜¯è¶…çº§è‹±é›„ï¼ˆWonder Womanï¼‰è¿˜æ˜¯åæ´¾è§’è‰²ï¼ˆThe Jokerï¼‰ã€‚

```python
from smolagents import CodeAgent, OpenAIServerModel

model = OpenAIServerModel(model_id="gpt-4o")

# å®ä¾‹åŒ–æ™ºèƒ½ä½“
agent = CodeAgent(
    tools=[],
    model=model,
    max_steps=20,
    verbosity_level=2
)

response = agent.run(
    """
    Describe the costume and makeup that the comic character in these photos is wearing and return the description.
    Tell me if the guest is The Joker or Wonder Woman.
    """,
    images=images
)
```

ä»¥ä¸‹æ˜¯æˆ‘çš„è¿è¡Œç»“æœï¼ˆå®é™…è¾“å‡ºå¯èƒ½å› ç¯å¢ƒå·®å¼‚æœ‰æ‰€ä¸åŒï¼Œæ­£å¦‚å‰æ–‡æ‰€è¿°ï¼‰ï¼š

```python
    {
        'Costume and Makeup - First Image': (
            'Purple coat and a purple silk-like cravat or tie over a mustard-yellow shirt.',
            'White face paint with exaggerated features, dark eyebrows, blue eye makeup, red lips forming a wide smile.'
        ),
        'Costume and Makeup - Second Image': (
            'Dark suit with a flower on the lapel, holding a playing card.',
            'Pale skin, green hair, very red lips with an exaggerated grin.'
        ),
        'Character Identity': 'This character resembles known depictions of The Joker from comic book media.'
    }
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¾“å‡ºç»“æœæ­ç¤ºäº†è¿™ä¸ªäººæ­£åœ¨å†’å……ä»–äººï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é˜»æ­¢ The Joker è¿›å…¥æ´¾å¯¹ï¼

## æä¾›åŠ¨æ€æ£€ç´¢å›¾åƒ

<Tip>
æ‚¨å¯ä»¥åœ¨ <a href="https://huggingface.co/agents-course/notebooks/blob/main/unit2/smolagents/vision_web_browser.py" target="_blank">è¿™ä¸ª Python æ–‡ä»¶</a> ä¸­æŸ¥çœ‹ä»£ç ã€‚
</Tip>

å‰é¢çš„æ–¹æ³•å…·æœ‰å¾ˆé«˜çš„ä»·å€¼ï¼Œå¹¶ä¸”æœ‰è®¸å¤šæ½œåœ¨çš„åº”ç”¨åœºæ™¯ã€‚ç„¶è€Œï¼Œåœ¨å®¢äººä¸åœ¨æ•°æ®åº“ä¸­çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ¢ç´¢å…¶ä»–è¯†åˆ«æ–¹å¼ã€‚ä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»å¤–éƒ¨æ¥æºåŠ¨æ€æ£€ç´¢å›¾åƒå’Œä¿¡æ¯ï¼Œä¾‹å¦‚é€šè¿‡æµè§ˆç½‘é¡µè·å–è¯¦ç»†ä¿¡æ¯ã€‚

åœ¨æ­¤æ–¹æ³•ä¸­ï¼Œå›¾åƒæ˜¯åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€æ·»åŠ åˆ°æ™ºèƒ½ä½“çš„è®°å¿†ä¸­çš„ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œ`smolagents` ä¸­çš„æ™ºèƒ½ä½“åŸºäº `MultiStepAgent` ç±»ï¼Œè¯¥ç±»æ˜¯ ReAct æ¡†æ¶çš„æŠ½è±¡ã€‚æ­¤ç±»ä»¥ç»“æ„åŒ–çš„å‘¨æœŸè¿è¡Œï¼Œåœ¨ä¸åŒé˜¶æ®µè®°å½•å„ç§å˜é‡å’ŒçŸ¥è¯†ï¼š

1. **SystemPromptStep:** å­˜å‚¨ç³»ç»Ÿæç¤ºã€‚
2. **TaskStep:** è®°å½•ç”¨æˆ·æŸ¥è¯¢å’Œæä¾›çš„ä»»ä½•è¾“å…¥ã€‚
3. **ActionStep:** æ•è·æ™ºèƒ½ä½“æ“ä½œå’Œç»“æœçš„æ—¥å¿—ã€‚

è¿™ç§ç»“æ„åŒ–çš„æ–¹æ³•ä½¿æ™ºèƒ½ä½“èƒ½å¤ŸåŠ¨æ€åœ°ç»“åˆè§†è§‰ä¿¡æ¯ï¼Œå¹¶å¯¹ä¸æ–­å˜åŒ–çš„ä»»åŠ¡åšå‡ºé€‚åº”æ€§å“åº”ã€‚ä»¥ä¸‹æ˜¯å·²ç»è§è¿‡çš„å›¾è¡¨ï¼Œå±•ç¤ºäº†åŠ¨æ€å·¥ä½œæµç¨‹è¿‡ç¨‹ä»¥åŠä¸åŒæ­¥éª¤å¦‚ä½•åœ¨æ™ºèƒ½ä½“ç”Ÿå‘½å‘¨æœŸå†…é›†æˆã€‚åœ¨æµè§ˆæ—¶ï¼Œæ™ºèƒ½ä½“å¯ä»¥æˆªå–å±å¹•æˆªå›¾å¹¶å°†å…¶ä¿å­˜ä¸º `ActionStep` ä¸­çš„ `observation_images`ã€‚

![Dynamic image retrieval](https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/blog/smolagents-can-see/diagram_adding_vlms_smolagents.png)

ç°åœ¨æˆ‘ä»¬ç†è§£äº†éœ€æ±‚ï¼Œè®©æˆ‘ä»¬æ„å»ºå®Œæ•´çš„ç¤ºä¾‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒAlfred å¸Œæœ›å®Œå…¨æ§åˆ¶è®¿å®¢éªŒè¯è¿‡ç¨‹ï¼Œå› æ­¤æµè§ˆè¯¦æƒ…æˆä¸ºå¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚ä¸ºäº†å®Œæˆè¿™ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ™ºèƒ½ä½“æä¾›ä¸€ç»„æ–°çš„å·¥å…·ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Selenium å’Œ Heliumï¼Œè¿™äº›æ˜¯æµè§ˆå™¨è‡ªåŠ¨åŒ–å·¥å…·ã€‚è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ„å»ºä¸€ä¸ªæ¢ç´¢ç½‘ç»œã€æœç´¢æ½œåœ¨è®¿å®¢è¯¦æƒ…å¹¶æ£€ç´¢éªŒè¯ä¿¡æ¯çš„æ™ºèƒ½ä½“ã€‚è®©æˆ‘ä»¬å®‰è£…æ‰€éœ€çš„å·¥å…·ï¼š

```bash
pip install "smolagents[all]" helium selenium python-dotenv
```

æˆ‘ä»¬éœ€è¦ä¸€ç»„ä¸“ä¸ºæµè§ˆè®¾è®¡çš„æ™ºèƒ½ä½“å·¥å…·ï¼Œä¾‹å¦‚â€œsearch_item_ctrl_fâ€ã€â€œgo_backâ€å’Œâ€œclose_popupsâ€ã€‚è¿™äº›å·¥å…·å…è®¸æ™ºèƒ½ä½“åƒæµè§ˆç½‘é¡µçš„äººä¸€æ ·è¡Œäº‹ã€‚

```python
@tool
def search_item_ctrl_f(text: str, nth_result: int = 1) -> str:
    """
    Searches for text on the current page via Ctrl + F and jumps to the nth occurrence.
    Args:
        text: The text to search for
        nth_result: Which occurrence to jump to (default: 1)
    """
    elements = driver.find_elements(By.XPATH, f"//*[contains(text(), '{text}')]")
    if nth_result > len(elements):
        raise Exception(f"Match nÂ°{nth_result} not found (only {len(elements)} matches found)")
    result = f"Found {len(elements)} matches for '{text}'."
    elem = elements[nth_result - 1]
    driver.execute_script("arguments[0].scrollIntoView(true);", elem)
    result += f"Focused on element {nth_result} of {len(elements)}"
    return result


@tool
def go_back() -> None:
    """Goes back to previous page."""
    driver.back()


@tool
def close_popups() -> str:
    """
    Closes any visible modal or pop-up on the page. Use this to dismiss pop-up windows! This does not work on cookie consent banners.
    """
    webdriver.ActionChains(driver).send_keys(Keys.ESCAPE).perform()
```

æˆ‘ä»¬è¿˜éœ€è¦ä¿å­˜å±å¹•æˆªå›¾çš„åŠŸèƒ½ï¼Œå› ä¸ºè¿™æ˜¯æˆ‘ä»¬çš„ VLM æ™ºèƒ½ä½“å®Œæˆä»»åŠ¡æ—¶å¿…ä¸å¯å°‘çš„ä¸€éƒ¨åˆ†ã€‚æ­¤åŠŸèƒ½ä¼šæ•è·å±å¹•æˆªå›¾å¹¶å°†å…¶ä¿å­˜åœ¨ `step_log.observations_images = [image.copy()]` ä¸­ï¼Œä»è€Œå…è®¸æ™ºèƒ½ä½“åœ¨å¯¼èˆªæ—¶åŠ¨æ€å­˜å‚¨å’Œå¤„ç†å›¾åƒã€‚

```python
def save_screenshot(step_log: ActionStep, agent: CodeAgent) -> None:
    sleep(1.0)  # è®© JavaScript åŠ¨ç”»åœ¨æˆªå›¾ä¹‹å‰å®Œæˆ
    driver = helium.get_driver()
    current_step = step_log.step_number
    if driver is not None:
        for step_logs in agent.logs:  # ä»æ—¥å¿—ä¸­åˆ é™¤å…ˆå‰çš„æˆªå›¾ä»¥è¿›è¡Œç²¾ç®€å¤„ç†
            if isinstance(step_log, ActionStep) and step_log.step_number <= current_step - 2:
                step_logs.observations_images = None
        png_bytes = driver.get_screenshot_as_png()
        image = Image.open(BytesIO(png_bytes))
        print(f"Captured a browser screenshot: {image.size} pixels")
        step_log.observations_images = [image.copy()]  # åˆ›å»ºå‰¯æœ¬ä»¥ç¡®ä¿å…¶æŒä¹…ä¿å­˜ï¼Œé‡è¦ï¼!

    # ä½¿ç”¨å½“å‰ URL æ›´æ–°è§‚å¯Ÿç»“æœ 
    url_info = f"Current url: {driver.current_url}"
    step_log.observations = url_info if step_logs.observations is None else step_log.observations + "\n" + url_info
    return
```

æ­¤å‡½æ•°ä½œä¸º `step_callback` ä¼ é€’ç»™æ™ºèƒ½ä½“ï¼Œå› ä¸ºå®ƒåœ¨æ™ºèƒ½ä½“æ‰§è¡Œçš„æ¯ä¸€æ­¥ç»“æŸæ—¶è¢«è§¦å‘ã€‚è¿™ä½¿å¾—æ™ºèƒ½ä½“èƒ½å¤Ÿåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­åŠ¨æ€æ•è·å’Œå­˜å‚¨å±å¹•æˆªå›¾ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆç”¨äºæµè§ˆç½‘é¡µçš„è§†è§‰æ™ºèƒ½ä½“ï¼Œä¸ºå…¶æä¾›æˆ‘ä»¬åˆ›å»ºçš„å·¥å…·ï¼Œä»¥åŠ `DuckDuckGoSearchTool` ä»¥æ¢ç´¢ç½‘é¡µã€‚æ­¤å·¥å…·å°†å¸®åŠ©æ™ºèƒ½ä½“æ ¹æ®è§†è§‰çº¿ç´¢æ£€ç´¢éªŒè¯è®¿å®¢èº«ä»½æ‰€éœ€çš„ä¿¡æ¯ã€‚

```python
from smolagents import CodeAgent, OpenAIServerModel, DuckDuckGoSearchTool
model = OpenAIServerModel(model_id="gpt-4o")

agent = CodeAgent(
    tools=[DuckDuckGoSearchTool(), go_back, close_popups, search_item_ctrl_f],
    model=model,
    additional_authorized_imports=["helium"],
    step_callbacks=[save_screenshot],
    max_steps=20,
    verbosity_level=2,
)
```

æœ‰äº†è¿™äº›ï¼ŒAlfred å‡†å¤‡æ£€æŸ¥è®¿å®¢çš„èº«ä»½ï¼Œå¹¶æ ¹æ®è¿™äº›ä¿¡æ¯åšå‡ºæ˜¯å¦å…è®¸ä»–ä»¬è¿›å…¥æ´¾å¯¹çš„æ˜æ™ºå†³å®šï¼š

```python
agent.run("""
I am Alfred, the butler of Wayne Manor, responsible for verifying the identity of guests at party. A superhero has arrived at the entrance claiming to be Wonder Woman, but I need to confirm if she is who she says she is.

Please search for images of Wonder Woman and generate a detailed visual description based on those images. Additionally, navigate to Wikipedia to gather key details about her appearance. With this information, I can determine whether to grant her access to the event.
""" + helium_instructions)
```

æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å°† `helium_instructions` ä½œä¸ºä»»åŠ¡çš„ä¸€éƒ¨åˆ†åŒ…å«åœ¨å†…ã€‚è¿™ä¸ªç‰¹æ®Šçš„æç¤ºæ—¨åœ¨æ§åˆ¶æ™ºèƒ½ä½“çš„å¯¼èˆªï¼Œç¡®ä¿å®ƒåœ¨æµè§ˆç½‘é¡µæ—¶éµå¾ªæ­£ç¡®çš„æ­¥éª¤ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹è¿™åœ¨ä¸‹é¢çš„è§†é¢‘ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š

<video controls>
  <source src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit2/smolagents/VisionBrowserAgent.mp4" type="video/mp4">
</video>

è¿™æ˜¯æœ€ç»ˆè¾“å‡ºï¼š

```python
Final answer: Wonder Woman is typically depicted wearing a red and gold bustier, blue shorts or skirt with white stars, a golden tiara, silver bracelets, and a golden Lasso of Truth. She is Princess Diana of Themyscira, known as Diana Prince in the world of men.
```

é€šè¿‡è¿™äº›æ­¥éª¤ï¼Œæˆ‘ä»¬æˆåŠŸåœ°ä¸ºæ´¾å¯¹åˆ›å»ºäº†ä¸€ä¸ªèº«ä»½éªŒè¯ç³»ç»Ÿï¼ Alfred ç°åœ¨æ‹¥æœ‰å¿…è¦çš„å·¥å…·ï¼Œå¯ä»¥ç¡®ä¿åªæœ‰æ­£ç¡®çš„å®¾å®¢èƒ½å¤Ÿè¿›å…¥åº„å›­ã€‚ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥äº«å—åœ¨éŸ¦æ©åº„å›­çš„ç¾å¥½æ—¶å…‰ï¼


## è¿›ä¸€æ­¥é˜…è¯»

- [æˆ‘ä»¬è®© smolagents æœ‰äº†è§†è§‰èƒ½åŠ›](https://huggingface.co/blog/smolagents-can-see) -  åšå®¢æ–‡ç« æè¿°äº†è§†è§‰æ™ºèƒ½ä½“çš„åŠŸèƒ½ã€‚
- [ä½¿ç”¨æ™ºèƒ½ä½“è¿›è¡Œç½‘é¡µæµè§ˆ ğŸ¤–ğŸŒ](https://huggingface.co/docs/smolagents/examples/web_browser) - ä½¿ç”¨è§†è§‰æ™ºèƒ½ä½“è¿›è¡Œç½‘é¡µæµè§ˆçš„ç¤ºä¾‹ã€‚
- [ç½‘é¡µæµè§ˆè§†è§‰æ™ºèƒ½ä½“ç¤ºä¾‹](https://github.com/huggingface/smolagents/blob/main/src/smolagents/vision_web_browser.py) - ä½¿ç”¨è§†è§‰æ™ºèƒ½ä½“è¿›è¡Œç½‘é¡µæµè§ˆçš„ç¤ºä¾‹ã€‚