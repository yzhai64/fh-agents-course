# HÃ£y táº¡o Agent Ä‘áº§u tiÃªn cá»§a chÃºng ta vá»›i smolagents

á» chÆ°Æ¡ng trÆ°á»›c, ta Ä‘Ã£ há»c cÃ¡ch táº¡o Agent tá»« Ä‘áº§u báº±ng Python vÃ  **tháº¥y quÃ¡ trÃ¬nh nÃ y tá»‘n cÃ´ng tháº¿ nÃ o**. May máº¯n thay, nhiá»u thÆ° viá»‡n Agent giÃºp Ä‘Æ¡n giáº£n hÃ³a cÃ´ng viá»‡c nÃ y báº±ng cÃ¡ch **xá»­ lÃ½ pháº§n lá»›n cÃ´ng Ä‘oáº¡n phá»©c táº¡p**.

Trong bÃ i thá»±c hÃ nh nÃ y, **báº¡n sáº½ táº¡o Agent Ä‘áº§u tiÃªn cá»§a riÃªng mÃ¬nh** cÃ³ kháº£ nÄƒng thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng nhÆ° táº¡o áº£nh, tÃ¬m kiáº¿m web, kiá»ƒm tra mÃºi giá» vÃ  hÆ¡n tháº¿ ná»¯a!

Báº¡n cÅ©ng sáº½ publish agent **trÃªn Hugging Face Space Ä‘á»ƒ chia sáº» vá»›i báº¡n bÃ¨ vÃ  Ä‘á»“ng nghiá»‡p**.

CÃ¹ng báº¯t Ä‘áº§u thÃ´i!


## smolagents lÃ  gÃ¬?

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/smolagents.png" alt="smolagents"/>

Äá»ƒ táº¡o Agent nÃ y, ta sáº½ dÃ¹ng `smolagents` - thÆ° viá»‡n **cung cáº¥p framework Ä‘á»ƒ phÃ¡t triá»ƒn agent dá»… dÃ ng**.

ThÆ° viá»‡n nháº¹ nÃ y Ä‘Æ°á»£c thiáº¿t káº¿ cho sá»± Ä‘Æ¡n giáº£n, nhÆ°ng nÃ³ Ä‘Ã³ng gÃ³i pháº§n lá»›n Ä‘á»™ phá»©c táº¡p khi xÃ¢y dá»±ng Agent, giÃºp báº¡n táº­p trung vÃ o thiáº¿t káº¿ hÃ nh vi cho agent.

Ta sáº½ tÃ¬m hiá»ƒu sÃ¢u hÆ¡n vá» smolagents á»Ÿ chÆ°Æ¡ng tiáº¿p theo. Trong lÃºc chá», báº¡n cÃ³ thá»ƒ xem <a href="https://huggingface.co/blog/smolagents" target="_blank">blog post</a> hoáº·c <a href="https://github.com/huggingface/smolagents" target="_blank">repo GitHub</a> cá»§a thÆ° viá»‡n.

TÃ³m láº¡i, `smolagents` lÃ  thÆ° viá»‡n táº­p trung vÃ o **codeAgent** - loáº¡i agent thá»±c hiá»‡n **"HÃ nh Ä‘á»™ng"** qua cÃ¡c khá»‘i code, sau Ä‘Ã³ **"Quan sÃ¡t"** káº¿t quáº£ báº±ng cÃ¡ch cháº¡y code.

ÄÃ¢y lÃ  vÃ­ dá»¥ nhá»¯ng gÃ¬ ta sáº½ xÃ¢y dá»±ng!

Ta cung cáº¥p cho agent **cÃ´ng cá»¥ táº¡o áº£nh** vÃ  yÃªu cáº§u nÃ³ táº¡o áº£nh mÃ¨o.

Agent trong `smolagents` sáº½ cÃ³ **hÃ nh vi giá»‘ng vá»›i agent tá»± build trÆ°á»›c Ä‘Ã¢y**: nÃ³ sáº½ **suy nghÄ©, hÃ nh Ä‘á»™ng vÃ  quan sÃ¡t theo chu ká»³** cho Ä‘áº¿n khi cÃ³ cÃ¢u tráº£ lá»i cuá»‘i:

<iframe width="560" height="315" src="https://www.youtube.com/embed/PQDKcWiuln4?si=ysSTDZoi8y55FVvA" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

ThÃº vá»‹ quÃ¡ pháº£i khÃ´ng?

## CÃ¹ng build Agent thÃ´i!

Äá»ƒ báº¯t Ä‘áº§u, duplicate Space nÃ y: <a href="https://huggingface.co/spaces/agents-course/First_agent_template" target="_blank">https://huggingface.co/spaces/agents-course/First_agent_template</a>
> Cáº£m Æ¡n <a href="https://huggingface.co/m-ric" target="_blank">Aymeric</a> Ä‘Ã£ táº¡o template nÃ y! ğŸ™Œ

Duplicate Space nghÄ©a lÃ  **táº¡o báº£n copy local trÃªn profile cá»§a báº¡n**:
<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/duplicate-space.gif" alt="Duplicate"/>

XuyÃªn suá»‘t BÃ i há»c nÃ y, file duy nháº¥t báº¡n cáº§n sá»­a lÃ  **"app.py"** (hiá»‡n Ä‘ang chÆ°a hoÃ n thiá»‡n). Báº¡n cÃ³ thá»ƒ xem [báº£n gá»‘c trong template](https://huggingface.co/spaces/agents-course/First_agent_template/blob/main/app.py). Äá»ƒ tÃ¬m báº£n cá»§a báº¡n, vÃ o báº£n copy Space, click tab `Files` rá»“i chá»n `app.py` trong danh sÃ¡ch.

CÃ¹ng phÃ¢n tÃ­ch code nhÃ©:

- File báº¯t Ä‘áº§u vá»›i cÃ¡c thÆ° viá»‡n cáº§n thiáº¿t

```python
from smolagents import CodeAgent, DuckDuckGoSearchTool, HfApiModel, load_tool, tool
import datetime
import requests
import pytz
import yaml
from tools.final_answer import FinalAnswerTool
```

NhÆ° Ä‘Ã£ Ä‘á» cáº­p, ta sáº½ dÃ¹ng trá»±c tiáº¿p lá»›p **CodeAgent** tá»« **smolagents**.


### CÃ¡c Tools

Giá» Ä‘áº¿n pháº§n Tools! Náº¿u cáº§n Ã´n láº¡i vá» Tools, hÃ£y xem láº¡i [pháº§n Tools](tools) cá»§a khÃ³a há»c.

```python
@tool
def my_custom_tool(arg1:str, arg2:int)-> str: # quan trá»ng pháº£i chá»‰ Ä‘á»‹nh kiá»ƒu tráº£ vá»
    # Giá»¯ nguyÃªn Ä‘á»‹nh dáº¡ng nÃ y cho mÃ´ táº£ cÃ´ng cá»¥/mÃ´ táº£ Ä‘á»‘i sá»‘ nhÆ°ng hÃ£y thoáº£i mÃ¡i sá»­a Ä‘á»•i cÃ´ng cá»¥
    """CÃ´ng cá»¥ chÆ°a lÃ m gÃ¬ cáº£
    Args:
        arg1: Ä‘á»‘i sá»‘ Ä‘áº§u tiÃªn
        arg2: Ä‘á»‘i sá»‘ thá»© hai
    """
    return "Báº¡n sáº½ táº¡o ra phÃ©p thuáº­t gÃ¬ Ä‘Ã¢y?"

@tool
def get_current_time_in_timezone(timezone: str) -> str:
    """CÃ´ng cá»¥ láº¥y giá» hiá»‡n táº¡i theo mÃºi giá» chá»‰ Ä‘á»‹nh.
    Args:
        timezone: Chuá»—i biá»ƒu diá»…n mÃºi giá» há»£p lá»‡ (vÃ­ dá»¥: 'America/New_York').
    """
    try:
        # Táº¡o object mÃºi giá»
        tz = pytz.timezone(timezone)
        # Láº¥y giá» hiá»‡n táº¡i theo mÃºi giá» Ä‘Ã³
        local_time = datetime.datetime.now(tz).strftime("%Y-%m-%d %H:%M:%S")
        return f"Giá» hiá»‡n táº¡i táº¡i {timezone} lÃ : {local_time}"
    except Exception as e:
        return f"Lá»—i khi láº¥y giá» cho mÃºi giá» '{timezone}': {str(e)}"
```


ÄÃ¢y chÃ­nh lÃ  pháº§n chÃºng mÃ¬nh khuyáº¿n khÃ­ch báº¡n xÃ¢y dá»±ng! ChÃºng mÃ¬nh cung cáº¥p hai vÃ­ dá»¥:

1. **Tool áº£o** chÆ°a hoáº¡t Ä‘á»™ng Ä‘á»ƒ báº¡n cÃ³ thá»ƒ sá»­a thÃ nh tool há»¯u Ã­ch.
2. **Tool thá»±c sá»± hoáº¡t Ä‘á»™ng** Ä‘á»ƒ láº¥y giá» hiá»‡n táº¡i á»Ÿ báº¥t ká»³ Ä‘Ã¢u.

Khi Ä‘á»‹nh nghÄ©a tool, quan trá»ng pháº£i:

1. Chá»‰ Ä‘á»‹nh kiá»ƒu Ä‘áº§u vÃ o/ra cho hÃ m, vÃ­ dá»¥ `get_current_time_in_timezone(timezone: str) -> str:`
2. **Docstring Ä‘á»‹nh dáº¡ng chuáº©n**. `smolagents` yÃªu cáº§u má»i Ä‘á»‘i sá»‘ pháº£i cÃ³ **mÃ´ táº£ báº±ng text trong docstring**.

### Agent

Agent sá»­ dá»¥ng [`Qwen/Qwen2.5-Coder-32B-Instruct`](https://huggingface.co/Qwen/Qwen2.5-Coder-32B-Instruct) lÃ m LLM engine. ÄÃ¢y lÃ  model máº¡nh máº½ mÃ  ta sáº½ truy cáº­p qua serverless API.

```python
final_answer = FinalAnswerTool()
model = HfApiModel(
    max_tokens=2096,
    temperature=0.5,
    model_id='Qwen/Qwen2.5-Coder-32B-Instruct',
    custom_role_conversions=None,
)

with open("prompts.yaml", 'r') as stream:
    prompt_templates = yaml.safe_load(stream)
    
# Táº¡o CodeAgent
agent = CodeAgent(
    model=model,
    tools=[final_answer], # thÃªm tools cá»§a báº¡n vÃ o Ä‘Ã¢y (Ä‘á»«ng xÃ³a final_answer)
    max_steps=6,
    verbosity_level=1,
    grammar=None,
    planning_interval=None,
    name=None,
    description=None,
    prompt_templates=prompt_templates
)

GradioUI(agent).launch()
```

Agent nÃ y váº«n dÃ¹ng `InferenceClient` mÃ  ta Ä‘Ã£ tháº¥y á»Ÿ pháº§n trÆ°á»›c thÃ´ng qua lá»›p **HfApiModel**!

ChÃºng mÃ¬nh sáº½ Ä‘Æ°a thÃªm vÃ­ dá»¥ chi tiáº¿t khi giá»›i thiá»‡u framework á»Ÿ chÆ°Æ¡ng 2. Hiá»‡n táº¡i, báº¡n cáº§n táº­p trung vÃ o **thÃªm tool má»›i vÃ o danh sÃ¡ch tools** qua tham sá»‘ `tools` cá»§a Agent.

VÃ­ dá»¥ báº¡n cÃ³ thá»ƒ dÃ¹ng `DuckDuckGoSearchTool` Ä‘Ã£ Ä‘Æ°á»£c import á»Ÿ dÃ²ng Ä‘áº§u, hoáº·c xem qua `image_generation_tool` Ä‘Æ°á»£c load tá»« Hub á»Ÿ pháº§n sau.

**ThÃªm tools sáº½ má»Ÿ rá»™ng kháº£ nÄƒng cho agent** - hÃ£y sÃ¡ng táº¡o nhÃ©!

ToÃ n bá»™ "app.py": 

```python
from smolagents import CodeAgent, DuckDuckGoSearchTool, HfApiModel, load_tool, tool
import datetime
import requests
import pytz
import yaml
from tools.final_answer import FinalAnswerTool

from Gradio_UI import GradioUI

# ÄÃ¢y lÃ  vÃ­ dá»¥ tool chÆ°a lÃ m gÃ¬. HÃ£y khiáº¿n chÃºng mÃ¬nh kinh ngáº¡c vá»›i sÃ¡ng táº¡o cá»§a báº¡n!
@tool
def my_custom_tool(arg1:str, arg2:int)-> str: # quan trá»ng pháº£i chá»‰ Ä‘á»‹nh kiá»ƒu tráº£ vá»
    # Giá»¯ nguyÃªn Ä‘á»‹nh dáº¡ng nÃ y cho mÃ´ táº£ cÃ´ng cá»¥/mÃ´ táº£ Ä‘á»‘i sá»‘ nhÆ°ng hÃ£y thoáº£i mÃ¡i sá»­a Ä‘á»•i cÃ´ng cá»¥
    """CÃ´ng cá»¥ chÆ°a lÃ m gÃ¬ cáº£
    Args:
        arg1: Ä‘á»‘i sá»‘ Ä‘áº§u tiÃªn
        arg2: Ä‘á»‘i sá»‘ thá»© hai
    """
    return "Báº¡n sáº½ táº¡o ra phÃ©p thuáº­t gÃ¬ Ä‘Ã¢y?"

@tool
def get_current_time_in_timezone(timezone: str) -> str:
    """CÃ´ng cá»¥ láº¥y giá» hiá»‡n táº¡i theo mÃºi giá» chá»‰ Ä‘á»‹nh.
    Args:
        timezone: Chuá»—i biá»ƒu diá»…n mÃºi giá» há»£p lá»‡ (vÃ­ dá»¥: 'America/New_York').
    """
    try:
        # Táº¡o object mÃºi giá»
        tz = pytz.timezone(timezone)
        # Láº¥y giá» hiá»‡n táº¡i theo mÃºi giá» Ä‘Ã³
        local_time = datetime.datetime.now(tz).strftime("%Y-%m-%d %H:%M:%S")
        return f"Giá» hiá»‡n táº¡i táº¡i {timezone} lÃ : {local_time}"
    except Exception as e:
        return f"Lá»—i khi láº¥y giá» cho mÃºi giá» '{timezone}': {str(e)}"


final_answer = FinalAnswerTool()
model = HfApiModel(
max_tokens=2096,
temperature=0.5,
model_id='Qwen/Qwen2.5-Coder-32B-Instruct',
custom_role_conversions=None,
)


# Import tool tá»« Hub
image_generation_tool = load_tool("agents-course/text-to-image", trust_remote_code=True)

with open("prompts.yaml", 'r') as stream:
    prompt_templates = yaml.safe_load(stream)
    
agent = CodeAgent(
    model=model,
    tools=[final_answer], # thÃªm tools cá»§a báº¡n vÃ o Ä‘Ã¢y (Ä‘á»«ng xÃ³a final_answer)
    max_steps=6,
    verbosity_level=1,
    grammar=None,
    planning_interval=None,
    name=None,
    description=None,
    prompt_templates=prompt_templates
)


GradioUI(agent).launch()
```

**Má»¥c tiÃªu** cá»§a báº¡n lÃ  lÃ m quen vá»›i Space vÃ  Agent. 

Hiá»‡n táº¡i, agent trong template **chÆ°a dÃ¹ng tool nÃ o**, hÃ£y thá»­ cung cáº¥p cho nÃ³ cÃ¡c tool cÃ³ sáºµn hoáº·c tá»± táº¡o tool má»›i!

ChÃºng mÃ¬nh ráº¥t mong chá» thÃ nh quáº£ agent tuyá»‡t vá»i cá»§a báº¡n á»Ÿ kÃªnh discord **#agents-course-showcase**!


---
ChÃºc má»«ng báº¡n Ä‘Ã£ build xong Agent Ä‘áº§u tiÃªn! Äá»«ng ngáº¡i chia sáº» vá»›i báº¡n bÃ¨ vÃ  Ä‘á»“ng nghiá»‡p nhÃ©.

VÃ¬ Ä‘Ã¢y lÃ  láº§n Ä‘áº§u thá»­ nghiá»‡m, viá»‡c agent cÃ³ lá»—i nhá» hoáº·c cháº¡y cháº­m lÃ  hoÃ n toÃ n bÃ¬nh thÆ°á»ng. á» cÃ¡c chÆ°Æ¡ng sau, ta sáº½ há»c cÃ¡ch xÃ¢y dá»±ng Agent tá»‘t hÆ¡n.

CÃ¡ch há»c tá»‘t nháº¥t lÃ  thá»±c hÃ nh, nÃªn Ä‘á»«ng ngáº§n ngáº¡i cáº­p nháº­t nÃ³, thÃªm tool má»›i, thá»­ vá»›i model khÃ¡c, v.v.

á» pháº§n tiáº¿p theo, báº¡n sáº½ hoÃ n thÃ nh BÃ i kiá»ƒm tra cuá»‘i cÃ¹ng vÃ  nháº­n certificate!